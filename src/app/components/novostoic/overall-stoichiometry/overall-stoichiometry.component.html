<form
    class="flex h-full flex-col justify-between"
    [formGroup]="form"
    (ngSubmit)="onSubmit()"
>
    <div>
        <div class="flex justify-between">
            <div>
                <h2 class="mb-2">Input your target molecule and precursor</h2>
                <p class="leading-6">
                    Youâ€™ll get the overall stoichiometry and theoretical yield.
                    Input format: KEGG ID, Common name, SMILES.
                </p>
            </div>
            <div class="flex items-end">
                <button
                    type="button"
                    class="rounded-md border p-2"
                    (click)="useExample()"
                >
                    <i class="pi pi-box mx-2"></i>
                    Use an Example
                </button>
            </div>
        </div>

        <!-- Molecule Input -->
        <div class="mt-8 flex gap-6">
            <div class="flex grow flex-col">
                <div class="flex items-center justify-between pb-2">
                    <div class="flex items-center">
                        <span class="green-dot mx-2"></span>
                        <span class="text-base font-semibold"
                            >Primary Precursor</span
                        >
                    </div>
                    <span class="pr-1"
                        >Example:
                        <span class="font-semibold underline cursor-pointer"
                            (click)="form.controls['primaryPrecursor'].setValue('Pyruvate')"
                            >Pyruvate</span
                        >,
                        <span class="font-semibold underline cursor-pointer"
                            (click)="form.controls['primaryPrecursor'].setValue('C00022')"
                            >C00022</span
                        >,
                        <span class="font-semibold underline cursor-pointer"
                            (click)="form.controls['primaryPrecursor'].setValue('CC(=O)C(=O)O')"
                            >CC(=O)C(=O)O</span
                        ></span
                    >
                </div>
                <div class="marvin-filter-container">
                    <div class="p-inputgroup">
                        <input
                            pInputText
                            type="text"
                            class="border-0"
                            formControlName="primaryPrecursor"
                            placeholder="CC(=O)C(=O)O"
                        />
                        <button
                            pButton
                            type="button"
                            class="p-button-secondary p-button-link p-button-outlined"
                            icon="pi pi-pencil mr-2"
                            (click)="showDialog$.next(true);
                                currentFormControl$.next('primaryPrecursor')"
                        >
                            <span class="font-semibold"
                                >Draw / Upload</span
                            >
                        </button>
                    </div>
                </div>
                <div
                    *ngIf="form.controls['primaryPrecursor'].value"
                    class="border-green-primary relative mt-4 flex h-[200px] grow items-center justify-center rounded-md border border-solid"
                >
                    <i
                        class="pi pi-check-circle absolute left-3 top-3"
                    ></i>
                    <img
                        class="h-[180px] w-auto"
                        src="https://www.genome.jp/Fig/compound/C00022.gif"
                    />
                </div>
            </div>
            <div class="mt-10 flex items-start">
                <svg
                    width="37"
                    height="37"
                    viewBox="0 0 37 37"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                >
                    <path
                        d="M5.46118 7.52002L16.4412 18.5L5.46118 29.48H10.9512L21.9312 18.5L10.9512 7.52002H5.46118Z"
                        fill="#224063"
                    />
                    <path
                        d="M15.0688 7.52002L26.0488 18.5L15.0688 29.48H20.5588L31.5388 18.5L20.5588 7.52002H15.0688Z"
                        fill="#224063"
                    />
                </svg>
            </div>
            <div class="flex grow flex-col">
                <div class="flex items-center justify-between pb-2">
                    <div class="flex items-center">
                        <span class="blue-dot mx-2"></span>
                        <span class="text-base font-semibold"
                            >Target Molecule</span
                        >
                    </div>
                    <span class="pr-1"
                        >Example:
                        <span class="font-semibold underline cursor-pointer"
                            (click)="form.controls['targetMolecule'].setValue('3HP')"
                        >3HP</span
                        >,
                        <span class="font-semibold underline cursor-pointer"
                            (click)="form.controls['targetMolecule'].setValue('C01013')"
                            >C01013</span
                        >,
                        <span class="font-semibold underline cursor-pointer"
                            (click)="form.controls['targetMolecule'].setValue('O=C(CCO)O')"
                            >O=C(CCO)O</span
                        ></span
                    >
                </div>
                <div class="marvin-filter-container">
                    <div class="p-inputgroup">
                        <input
                            pInputText
                            type="text"
                            class="border-0"
                            formControlName="targetMolecule"
                            placeholder="Name, SMILES, InChi, Kegg ID"
                        />
                        <button
                            pButton
                            type="button"
                            class="p-button-secondary p-button-link p-button-outlined"
                            icon="pi pi-pencil mr-2"
                            (click)="showDialog$.next(true);
                                currentFormControl$.next('targetMolecule')"
                        >
                            <span class="font-semibold"
                                >Draw / Upload</span
                            >
                        </button>
                    </div>
                </div>
                <div
                    *ngIf="form.controls['targetMolecule'].value"
                    class="border-blue-primary relative mt-4 flex h-[200px] grow items-center justify-center rounded-md border border-solid"
                >
                    <i
                        class="pi pi-check-circle absolute left-3 top-3"
                    ></i>
                    <img
                        class="h-[180px] w-auto"
                        src="https://www.genome.jp/Fig/compound/C21389.gif"
                    />
                </div>
            </div>
        </div>
    </div>

    <!-- Subscription Email Input -->
    <div
        class="sticky bottom-0 flex justify-between rounded-t-md bg-[#F3F5FB] px-10 pt-8"
    >
        <div class="flex flex-col">
            <div class="mb-2 flex items-end justify-center">
                <span class="mb-1 pr-12">
                    <h2 class="m-0 mr-2 inline">Email</h2>
                    Leave an email to get an notification when your
                    results are ready.
                </span>
            </div>
            <div class="w-full">
                <input
                    id="subscriber-email"
                    type="email"
                    aria-describedby="subscriber-email-help"
                    [class]="'h-12 w-full'
                    + ((form.controls['subscriberEmail'].invalid
                        && form.controls['subscriberEmail'].dirty) ? ' ng-invalid ng-dirty' : '')"
                    pInputText
                    placeholder="Enter email here"
                    formControlName="subscriberEmail"
                />
                <small
                    *ngIf="form.controls['subscriberEmail'].invalid
                        && form.controls['subscriberEmail'].dirty"
                    id="subscriber-email-help"
                    class="p-error mt-2 block"
                    >Email is invalid.</small
                >
            </div>
            <div class="py-4">
                <p-checkbox
                    name="subscription"
                    styleClass="subscription-checkbox"
                    label="Agree to receive email notifications and updates about Novostoic."
                    [binary]="true"
                    [formControl]="form.controls['agreeToSubscription']"
                ></p-checkbox>
            </div>
        </div>
        <p-button
            label="Get the Overall Stoichiometry"
            type="submit"
            styleClass="bg-[#224063]"
            [disabled]="form.invalid"
            iconPos="right"
            icon="pi pi-arrow-right"
        ></p-button>
    </div>
</form>

<p-dialog
    *ngIf="showDialog$.value"
    class="marvin-editor-container"
    [visible]="showDialog$.value"
    (visibleChange)="showDialog$.next($event)"
    [modal]="true"
    [draggable]="false"
    [resizable]="false"
>
    <app-marvin-js-editor
        class="marvin-editor"
        [smiles]="form.controls[currentFormControl$.value].value || ''"
        (smilesChange)="form.controls[currentFormControl$.value].setValue($event)"
    ></app-marvin-js-editor>
    <ng-template pTemplate="footer">
        <p-button
            icon="pi pi-check"
            (click)="searchStructure()"
            label="Search Structure"
            styleClass="bg-[#224063]"
        ></p-button>
    </ng-template>
</p-dialog>
